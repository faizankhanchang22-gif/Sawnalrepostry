<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SHAHEEN AIO DOWNLOADER ü¶Ö</title>

<style>
/* --- General Styles --- */
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;background:transparent!important;color:#fff;font-family:Arial, sans-serif;overflow-x:hidden;}

/* --- Splash Screen & Start Button (SHAHEEN THEME: Green/Purple/Red) --- */
.splash-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);display:flex;justify-content:center;align-items:center;z-index:1000;}
.splash-screen.hidden{display:none}
.start-btn{padding:18px 50px;font-size:22px;font-weight:bold;background:linear-gradient(135deg,#06b6d4,#10b981); /* Cyan-Green Gradient (New Shaheen Vibe) */ color:#fff;border:none;border-radius:50px;cursor:pointer;box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);transition: transform 0.2s;}
.start-btn:active{transform:scale(0.95);}

/* --- Main App Container --- */
.main-app{display:none; width:100%; height:100%;}
.main-app.active{display:block}
.video-bg{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;opacity: 0.7;}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);z-index:0;}
.container{position:relative;z-index:5;width:100%;height:100%;padding:20px;overflow-y:auto;display:flex;flex-direction:column;max-width: 600px; margin: 0 auto;}

/* --- Header (SHAHEEN THEME) --- */
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.header-left h1{font-size:24px;background:linear-gradient(90deg,#10b981,#06b6d4);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight: 800;text-transform: uppercase;letter-spacing: 1px;}
.back-btn{padding:8px 15px;border-radius:6px;border:1px solid #10b981;background:rgba(16, 185, 129, 0.15);color:#a7f3d0;font-weight:bold;cursor:pointer;font-size: 12px;}
.section{width:100%;background:rgba(0,0,0,0.6);padding:20px;border-radius:15px;border: 1px solid rgba(255,255,255,0.05);margin-bottom:20px;}

/* --- Input and Button Styles (SHAHEEN THEME) --- */
.input-field {
    width: 100%;
    padding: 15px;
    background: rgba(255,255,255,.1);
    color: #fff;
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 10px;
    font-size: 16px;
    outline: none;
    text-align: center;
}
.fetch-btn{width:100%;padding:14px;background:linear-gradient(135deg,#10b981,#06b6d4);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;text-transform: uppercase;letter-spacing: 1px;box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);}
.fetch-btn:disabled{ opacity: 0.7; cursor: wait; }

/* --- Results Display (Download Links) --- */
.results-display {
    min-height: 150px;
    color: #f0f0f0;
    text-align: left;
    padding-top: 5px;
}
.video-info-container {
    padding-top: 15px; 
    border-top: 1px dashed rgba(255, 255, 255, 0.1); 
    margin-top: 15px;
}
.video-info h3 {
    font-size: 1.1em;
    font-weight: bold;
    color: #06b6d4; /* Cyan Accent */
    margin-bottom: 10px;
}
.video-info p {
    font-size: 0.9em;
    color: #ddd;
    font-weight: normal;
    white-space: pre-wrap; 
}

/* New style for the link wrapper */
.download-item {
    background: rgba(255, 255, 255, 0.1);
    margin-bottom: 8px;
    padding: 10px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
/* Quality and Size Info Style */
.download-item-info {
    color:#ddd; 
    font-weight: 500;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}
.download-item-quality {
    font-size: 1em;
    font-weight: bold;
    margin-bottom: 3px;
}
.download-item-size {
    font-size: 0.8em;
    color: #9ca3af;
}

/* Quality Button Style */
.download-link {
    cursor: pointer; 
    text-decoration: none;
    padding: 8px 14px;
    border-radius: 5px;
    font-size: 0.9em;
    font-weight: bold;
    text-transform: uppercase;
    transition: background 0.2s;
    text-align: center;
    min-width: 120px; 
}
/* Style for Video Link */
.download-link.video {
    background: #10b981; /* Shaheen Green */
    color: #042f21;
}
/* Style for Audio Link */
.download-link.audio {
    background: #06b6d4; /* Shaheen Cyan */
    color: #fff;
}
.download-link:hover {
    opacity: 0.8;
}

/* --- Utility/Feedback Styles --- */
.loader {border: 3px solid rgba(255, 255, 255, 0.1);border-radius: 50%;border-top: 3px solid #10b981; /* Green loader */ width: 30px; height: 30px;animation: spin 0.8s linear infinite;margin: 10px auto;display: none;}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.error-message {margin-top:15px;padding:12px;background:rgba(220, 38, 38, 0.2);border-left: 4px solid #ef4444;color: #fca5a5;border-radius:4px;display:none;text-align: left;font-size: 14px;}
.error-message.show{display:block}
</style>
</head>

<body>

<div class="splash-screen" id="splashScreen">
    <button class="start-btn" onclick="startApp()">START SHAHEEN AIO DOWNLOADER ü¶Ö</button>
</div>

<div class="main-app" id="mainApp">
    <video class="video-bg" id="videoBg" autoplay loop playsinline>
        <source src="https://raw.githubusercontent.com/faizankhanchang22-gif/Fauzuna/0d8386c8d7fa219d8a3390a01ba59402d7b31dab/AQPYKYVB-nMO-Ray4szZJNQQ3QMxLMzxeRYxOgW2bFyfnEB9m7qPgNqa0mY7l9gcciWi1SarcQgjp0Jk6Ttxa24kVYMMqMFOyUCWh5o.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
    <div class="overlay"></div>

    <div class="container">
        <header>
            <div class="header-left"><h1>SHAHEEN AIO DOWNLOADER</h1></div>
            <button class="back-btn" onclick="location.reload()">RESET</button>
        </header>

        <div class="section">
            <div class="input-group">
                <input type="text" id="videoUrlInput" class="input-field" placeholder="Enter Video URL (YouTube, TikTok, Instagram, etc.)">
            </div>
            
            <p class="help-text" style="color:#aaa; font-size: 12px; margin-bottom: 10px;">
                üí° SHAHEEN AIO System. Enter any valid social media video link.
            </p>
            <button class="fetch-btn" id="fetchBtn" onclick="fetchDownloadLinks()">
                <span id="btnText">FETCH DOWNLOAD LINKS</span>
            </button>
            <div class="loader" id="loader"></div>
            <div class="error-message" id="errorMessage"></div>
        </div>
        
        <div class="section results-display" id="resultsDisplay">
            <div style="color: #9ca3af;">
                Download links will appear here after fetching.
            </div>
        </div>

    </div>
</div>

<script>
// ‚≠ê AIO API URL (TOXXIC API) ‚≠ê
const AIO_API_BASE_URL = "https://api-toxxic.zone.id/api/downloader/aio";

function startApp(){
    document.getElementById("splashScreen").classList.add("hidden");
    document.getElementById("mainApp").classList.add("active");
    
    let video = document.getElementById("videoBg");
    video.play().catch(e => {
        console.warn("Autoplay blocked (needs unmuted):", e.name);
    }); 
}

// ‚≠ê Force Download Function (Ensures automatic download) ‚≠ê
function forceDownload(event, url, filename) {
    event.preventDefault(); 
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    a.rel = 'noreferrer'; 
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    console.log(`Download attempt for: ${filename}`);
}

// Helper to convert bytes (if present) into readable size (MB/KB)
function formatBytes(bytes, decimals = 2) {
    if (bytes === 0 || typeof bytes !== 'number') return 'Size N/A';
    if (bytes < 0) return 'Size N/A';

    const k = 1024;
    const dm = decimals < 0 ? 0 : decimals;
    const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];

    const i = Math.floor(Math.log(bytes) / Math.log(k));

    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
}

/**
 * Fetches Content-Length header using a HEAD request to get file size.
 * Uses a 20s timeout for slow servers.
 * @param {string} url - The direct download URL.
 * @returns {Promise<number|null>} File size in bytes or null on failure.
 */
async function fetchFileSize(url) {
    if (!url) return null;
    try {
        const response = await fetch(url, {
            method: 'HEAD',
            mode: 'cors', 
            signal: AbortSignal.timeout(20000) 
        });

        const contentLength = response.headers.get('Content-Length');
        
        if (response.ok && contentLength) {
            return parseInt(contentLength, 10);
        }
        return null;
    } catch (error) {
        // console.warn(`Could not fetch size for URL: ${url}. Error:`, error.message);
        return null;
    }
}


async function fetchDownloadLinks(){
    let url = document.getElementById("videoUrlInput").value.trim();
    
    let resultsDisplay = document.getElementById("resultsDisplay");
    let btn = document.getElementById("fetchBtn");
    let btnText = document.getElementById("btnText");
    let loader = document.getElementById("loader");
    let errorDiv = document.getElementById("errorMessage");

    if(!url || !url.startsWith('http')){
        errorDiv.textContent = "‚ö†Ô∏è Please enter a valid URL (starting with http or https).";
        errorDiv.classList.add("show");
        resultsDisplay.innerHTML = '<div style="color: #9ca3af;">Download links will appear here after fetching.</div>';
        return;
    }

    resultsDisplay.innerHTML = '<div style="color: #9ca5af;">Fetching links for URL: ' + url + '...</div>';
    errorDiv.classList.remove("show");
    btn.disabled = true;
    btnText.textContent = "FETCHING...";
    loader.style.display = "block";

    try{
        const apiUrl = `${AIO_API_BASE_URL}?url=${encodeURIComponent(url)}`;

        const response = await fetch(apiUrl, {
            method: 'GET',
            signal: AbortSignal.timeout(60000) 
        });

        if(!response.ok){
            const errorStatus = response.status;
            let errorMessageText = `Server Error: ${errorStatus}. SHAHEEN system is facing an issue.`;
            
            try {
                const errorData = await response.json();
                if (errorData.message) {
                    errorMessageText += ` API Message: ${errorData.message}`;
                } else if (errorData.result === false && errorData.data) {
                    errorMessageText += ` API Result Message: ${errorData.data.error || 'Video not found.'}`;
                }
            } catch(e) { /* silent fail */ }
            
            throw new Error(errorMessageText);
        }

        const data = await response.json();
        
        const statusOk = data.result === true && data.data;

        if (statusOk) {
            await displayDownloadLinks(data.data); 
        } else {
             throw new Error(`SHAHEEN System Error. Message: ${data.message || data.error || data.creator || 'Video not found or unsupported URL.'}`);
        }

    } catch(error){
        console.error("API Fetch Failed:", error);
        let displayMessage = `‚ùå Fetch failed: ${error.message}`;
        errorDiv.textContent = displayMessage;
        errorDiv.classList.add("show");
        resultsDisplay.innerHTML = '<div style="color: #fca5a5;">Error during link retrieval. Please verify the URL.</div>';
    }

    btn.disabled = false;
    btnText.textContent = "FETCH DOWNLOAD LINKS";
    loader.style.display = "none";
}

// Function to dynamically display links and then fetch sizes
async function displayDownloadLinks(result){
    const displayElement = document.getElementById("resultsDisplay");
    let linksHtml = '';
    let infoHtml = '';
    let foundLinks = 0;
    
    const title = result.title || 'Video Title Not Found';
    const filenameSuffix = title.replace(/\s/g, '_').replace(/[^a-zA-Z0-9._-]/g, '').substring(0, 30); 
    
    // 2. Build Links Section (UPPER PART)
    const linkArray = result.medias; 

    if (linkArray && Array.isArray(linkArray) && linkArray.length > 0) {
        linkArray.forEach((linkItem, index) => {
            const itemUrl = linkItem.url;
            const itemQuality = linkItem.resolution || linkItem.quality; 
            const itemType = linkItem.type || (linkItem.is_audio ? 'Audio' : 'Video');
            
            if (itemUrl && itemQuality) {
                // Generate unique ID for the size display span
                const itemId = `size-${index}-${Date.now()}`; 
                
                const extension = itemType === 'Audio' ? 'm4a' : 'mp4';
                
                linksHtml += `
                    <div class="download-item" style="background: ${itemType === 'Audio' ? 'rgba(6, 182, 212, 0.2)' : 'rgba(255, 255, 255, 0.1)'};">
                        <div class="download-item-info">
                            <span class="download-item-quality">${itemType === 'Audio' ? 'üéµ' : 'üé•'} ${itemQuality.toUpperCase()}</span>
                            <span class="download-item-size" id="${itemId}">Fetching size...</span>
                        </div>
                        <a href="${itemUrl}" 
                           onclick="forceDownload(event, '${itemUrl}', '${filenameSuffix}_${itemQuality.replace(/\s/g, '_')}.${extension}')" 
                           class="download-link ${itemType === 'Audio' ? 'audio' : 'video'}">
                            DOWNLOAD
                        </a>
                    </div>
                `;
                
                // Asynchronously fetch size and update the span
                setTimeout(() => {
                    fetchFileSize(itemUrl).then(sizeInBytes => {
                        const sizeSpan = document.getElementById(itemId);
                        if (sizeSpan) {
                            sizeSpan.textContent = `(${formatBytes(sizeInBytes)})`;
                        }
                    }).catch(e => {
                         const sizeSpan = document.getElementById(itemId);
                         if (sizeSpan) sizeSpan.textContent = '(Size N/A)';
                    });
                }, 100 * index); // Stagger requests for better performance

                foundLinks++;
            }
        });
    }

    // 3. Build Info Section (LOWER PART - About/Title)
    infoHtml += `
        <div class="video-info-container">
            <div class="video-info">
                <h3>ü¶Ö SHAHEEN DOWNLOADER ü¶Ö</h3>
                <p>
                    **TITLE:** ${title}
                </p>
                <div style="font-size: 0.8em; color: #aaa; font-weight: normal; margin-top: 5px;">
                    DOWNLOADER: SHAHEEN ü¶Ö (CREDIT: SHAHEEN)
                </div>
            </div>
        </div>
    `;

    // 4. Initial Output 
    if (foundLinks > 0) {
        displayElement.innerHTML = linksHtml + infoHtml;
        
    } else {
        displayElement.innerHTML = `
            <div style="color: #fca5a5;">
                ‚ùå Download links could not be found for this URL. 
                (Message: Video not found or link restricted.)
            </div>
        `;
    }
}
</script>
</body>
    </html>
